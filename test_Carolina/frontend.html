<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OptimumG License Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style>
        body {
            background-color: #f9fbfbbe; 
            font-family: Inter, sans-serif;
            margin: 0;
            padding-bottom: 50px;
        }
        .animate-spin-slow {
            animation: spin 2s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="p-4">

    <div id="root"></div>

    <footer class="mt-8 pt-4 max-w-4xl mx-auto border-t border-gray-200 text-center text-sm text-gray-500 p-4">
        <p>Simulated License Management System (Build 1.0). Built using React and Tailwind CSS.</p>
        <p class="mt-2">Running on: <span class="font-semibold text-gray-700" id="footer-backend-source">Loading...</span></p>
    </footer>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        
        const SvgIcon = ({ children, className, ...rest }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
                {...rest}
            >
                {children}
            </svg>
        );

        const KeyIcon = (props) => (
            <SvgIcon {...props}>
                <path d="m20.94 11.58-1.57-1.57a6.23 6.23 0 0 0-4.22-1.7V5.5l-3.2 3.2v2.1c-.8.8-1.7 1.4-2.7 1.8l-1.6 1.6v2.1h2.1l3.3-3.3c.7.3 1.5.5 2.3.5 1.7 0 3.3-.6 4.5-1.7l1.5-1.5z"/>
                <circle cx="11" cy="11" r="3"/>
                <path d="m16 8 3-3"/>
            </SvgIcon>
        );

        const PowerIcon = (props) => (
            <SvgIcon {...props}>
                <path d="M18.36 6.64a9 9 0 1 1-12.73 0"/>
                <line x1="12" x2="12" y1="2" y2="12"/>
            </SvgIcon>
        );

        const LoaderIcon = (props) => (
            <SvgIcon {...props}>
                <path d="M21 12a9 9 0 1 1-6.219-8.4"/>
            </SvgIcon>
        );

        const AlertTriangleIcon = (props) => (
            <SvgIcon {...props}>
                <path d="m21.73 18-9-16-9 16h18Z"/>
                <path d="M12 9v4"/>
                <path d="M12 17h.01"/>
            </SvgIcon>
        );

        const CheckCircleIcon = (props) => (
            <SvgIcon {...props}>
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <path d="M9 11l3 3L22 4"/>
            </SvgIcon>
        );

        const ClockIcon = (props) => (
            <SvgIcon {...props}>
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
            </SvgIcon>
        );

        const ZapIcon = (props) => (
            <SvgIcon {...props}>
                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
            </SvgIcon>
        );

        const Key = KeyIcon;
        const Power = PowerIcon;
        const Loader = LoaderIcon;
        const AlertTriangle = AlertTriangleIcon;
        const CheckCircle = CheckCircleIcon;
        const Clock = ClockIcon;
        const Zap = ZapIcon;

        const getFutureDate = (months) => {
            const date = new Date();
            date.setMonth(date.getMonth() + months);
            return date;
        };
        const MOCK_LICENSE_EXPIRY = getFutureDate(3);

        const MOCK_DB = {
            status: 'Not Activated', 
            key: null,
            expiryDate: null,
        };

        const mockFetchStatus = () => new Promise((resolve) => {
            setTimeout(() => {
                resolve({
                    status: MOCK_DB.status,
                    key: MOCK_DB.key,
                    expiryDate: MOCK_DB.expiryDate ? MOCK_DB.expiryDate.toISOString().split('T')[0] : 'N/A',
                });
            }, 500);
        });

        const mockActivate = (key) => new Promise((resolve, reject) => {
            setTimeout(() => {
                if (key && key.length >= 16 && key.toUpperCase().includes('G')) {
                    MOCK_DB.status = 'Active';
                    MOCK_DB.key = key.toUpperCase();
                    MOCK_DB.expiryDate = MOCK_LICENSE_EXPIRY;
                    resolve(true);
                } else {
                    reject(new Error("Invalid or revoked key. (Mock Failure: Requires 16+ chars and 'G')"));
                }
            }, 1200);
        });

        const mockDeactivate = () => new Promise((resolve) => {
            setTimeout(() => {
                MOCK_DB.status = 'Not Activated';
                MOCK_DB.key = null;
                MOCK_DB.expiryDate = null;
                resolve(true);
            }, 800);
        });

        const isCppBackend = typeof window.licenseAddon === 'object' && window.licenseAddon !== null && typeof window.licenseAddon.getStatus === 'function';

        const cppFetchStatus = () => {
            const statusData = window.licenseAddon.getStatus();
            return {
                status: statusData.isActive ? 'Active' : 'Not Activated',
                key: statusData.key || null,
                expiryDate: statusData.expiryDate || 'N/A',
            };
        };

        const cppActivate = (key) => {
            const success = window.licenseAddon.activate(key);
            if (!success) {
                throw new Error("Activation failed. Invalid key format or internal error.");
            }
            return success;
        };

        const cppDeactivate = () => {
            const success = window.licenseAddon.deactivate();
            if (!success) {
                throw new Error("Deactivation failed.");
            }
            return success;
        };

        const fetchLicenseStatus = () => {
            return isCppBackend ? cppFetchStatus() : mockFetchStatus();
        };

        const activateLicense = (key) => {
            return isCppBackend ? new Promise((resolve, reject) => {
                try {
                    resolve(cppActivate(key));
                } catch (e) {
                    reject(e);
                }
            }) : mockActivate(key);
        };

        const deactivateLicense = () => {
            return isCppBackend ? new Promise((resolve, reject) => {
                try {
                    resolve(cppDeactivate());
                } catch (e) {
                    reject(e);
                }
            }) : mockDeactivate();
        };
        
        function App() {
            const [licenseStatus, setLicenseStatus] = useState(null);
            const [licenseKeyInput, setLicenseKeyInput] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [message, setMessage] = useState({ text: '', type: 'info' });
            const [backendSource] = useState(isCppBackend ? 'C++ Native Addon' : 'JavaScript Mock Service');

            useEffect(() => {
                const footerElement = document.getElementById('footer-backend-source');
                if (footerElement) {
                    footerElement.textContent = backendSource;
                }
            }, [backendSource]);

            const loadStatus = async () => {
                setIsLoading(true);
                setMessage({ text: 'Checking license status...', type: 'info' });
                try {
                    const status = await fetchLicenseStatus();
                    setLicenseStatus(status);
                    setMessage({ text: 'License status loaded successfully.', type: 'success' });
                } catch (error) {
                    console.error("Status loading error:", error);
                    setMessage({ text: `Failed to load status: ${error.message}`, type: 'error' });
                    setLicenseStatus(null);
                } finally {
                    setIsLoading(false);
                }
            };

            useEffect(() => {
                loadStatus();
            }, []);

            const handleActivate = async () => {
                if (!licenseKeyInput.trim()) {
                    setMessage({ text: 'Please enter a license key.', type: 'warning' });
                    return;
                }

                setIsLoading(true);
                setMessage({ text: 'Attempting to activate license...', type: 'info' });
                try {
                    await activateLicense(licenseKeyInput.trim());
                    setMessage({ text: 'License successfully activated!', type: 'success' });
                    setLicenseKeyInput('');
                    await loadStatus();
                } catch (error) {
                    console.error("Activation error:", error);
                    setMessage({ text: `Activation failed: ${error.message}`, type: 'error' });
                } finally {
                    setIsLoading(false);
                }
            };

            const handleDeactivate = async () => {
                setIsLoading(true);
                setMessage({ text: 'Attempting to deactivate license...', type: 'info' });
                try {
                    await deactivateLicense();
                    setMessage({ text: 'License successfully deactivated.', type: 'success' });
                    await loadStatus();
                } catch (error) {
                    console.error("Deactivation error:", error);
                    setMessage({ text: `Deactivation failed: ${error.message}`, type: 'error' });
                } finally {
                    setIsLoading(false);
                }
            };

            const { statusText, statusClasses, statusIcon: StatusIcon } = useMemo(() => {
                if (!licenseStatus) {
                    return { statusText: 'LOADING...', statusClasses: 'bg-gray-400', statusIcon: Loader };
                }
                const status = licenseStatus.status;
                const expiryDate = licenseStatus.expiryDate;
                
                const isExpired = expiryDate !== 'N/A' && new Date(expiryDate) < new Date();

                if (status === 'Active' && isExpired) {
                    return { statusText: 'EXPIRED', statusClasses: 'bg-red-600', statusIcon: Clock };
                }
                
                switch (status) {
                    case 'Active':
                        return { statusText: 'ACTIVE', statusClasses: 'bg-green-600', statusIcon: CheckCircle };
                    case 'Not Activated':
                    default:
                        return { statusText: 'INACTIVE', statusClasses: 'bg-yellow-600', statusIcon: Power };
                }
            }, [licenseStatus]);

            const messageClasses = useMemo(() => {
                switch (message.type) {
                    case 'success': return 'bg-green-100 text-green-700 border-green-400';
                    case 'error': return 'bg-red-100 text-red-700 border-red-400';
                    case 'warning': return 'bg-yellow-100 text-yellow-700 border-yellow-400';
                    case 'info':
                    default: return 'bg-blue-100 text-blue-700 border-blue-400';
                }
            }, [message.type]);


            return (
                <div className="min-h-screen bg-gray-50 flex items-center justify-center p-4 font-inter">
                    <div className="w-full max-w-4xl bg-white shadow-2xl rounded-xl overflow-hidden transition-all duration-300">

                        <div className="p-6 bg-indigo-700 text-white flex justify-between items-center flex-wrap">
                            <h1 className="text-3xl font-bold tracking-tight mb-2 sm:mb-0">
                                OptimumG License Manager
                            </h1>
                            <div className="flex items-center space-x-4">
                                <span className="text-sm font-medium opacity-80 hidden sm:inline">
                                    Backend: {backendSource}
                                </span>
                                <button
                                    onClick={loadStatus}
                                    disabled={isLoading}
                                    className="flex items-center space-x-2 p-2 bg-indigo-600 hover:bg-indigo-500 rounded-lg transition duration-150 shadow-md disabled:opacity-70 disabled:cursor-wait"
                                    title="Refresh Status"
                                >
                                    <Loader className={`h-5 w-5 ${isLoading ? 'animate-spin' : ''}`} />
                                    <span className="hidden sm:inline">Refresh</span>
                                </button>
                            </div>
                        </div>

                        <div className="p-6 space-y-8">

                            <div className="p-6 bg-gray-100 border border-gray-200 rounded-lg shadow-inner">
                                <h2 className="text-xl font-semibold mb-4 text-gray-700 flex items-center">
                                    <Zap className="h-6 w-6 mr-2 text-indigo-700" />
                                    Current License Status
                                </h2>
                                {licenseStatus ? (
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-center sm:text-left">
                                        
                                        <div className="space-y-1 col-span-2 md:col-span-1">
                                            <p className="text-sm font-medium text-gray-500">Status</p>
                                            <div className={`inline-flex items-center px-4 py-1.5 rounded-full text-white font-bold tracking-wider text-sm shadow-md ${statusClasses} transition-colors duration-300`}>
                                                <StatusIcon className="h-4 w-4 mr-2" />
                                                {statusText}
                                            </div>
                                        </div>

                                        <div className="space-y-1 col-span-2 md:col-span-1">
                                            <p className="text-sm font-medium text-gray-500">Active Key</p>
                                            <p className="text-lg font-mono text-gray-800 break-all">
                                                {licenseStatus.key ? `${licenseStatus.key.substring(0, 4)}...${licenseStatus.key.substring(licenseStatus.key.length - 4)}` : 'N/A'}
                                            </p>
                                        </div>

                                        <div className="space-y-1 col-span-2 md:col-span-1">
                                            <p className="text-sm font-medium text-gray-500">Expiration</p>
                                            <p className="text-lg font-semibold text-gray-800">
                                                {licenseStatus.expiryDate || 'N/A'}
                                            </p>
                                        </div>
                                        
                                        <div className="space-y-1 col-span-2 md:col-span-1">
                                            <p className="text-sm font-medium text-gray-500">Source</p>
                                            <p className="text-lg font-medium text-gray-600">
                                                {backendSource}
                                            </p>
                                        </div>
                                    </div>
                                ) : (
                                    <div className='text-center py-4 text-gray-500'>
                                        <AlertTriangle className="h-6 w-6 inline-block mb-1 mr-2" />
                                        {isLoading ? 'Loading...' : 'Could not fetch license status.'}
                                    </div>
                                )}
                            </div>

                            {message.text && (
                                <div className={`p-4 border-l-4 rounded-lg transition-all duration-300 ${messageClasses} shadow-sm`} role="alert">
                                    <p className="font-medium">{message.text}</p>
                                </div>
                            )}

                            <div className="p-6 bg-white border border-gray-200 rounded-lg shadow-lg">
                                <h2 className="text-xl font-semibold mb-4 text-gray-700 flex items-center">
                                    <Key className="h-5 w-5 mr-2 text-indigo-700" />
                                    License Actions
                                </h2>

                                <div className="space-y-6">
                                    <div className="border p-4 rounded-lg bg-indigo-50/50">
                                        <h3 className="text-lg font-medium mb-3 text-gray-800 flex items-center">
                                            <Zap className="h-4 w-4 mr-2 text-indigo-600" /> Activate New License
                                        </h3>
                                        <div className="flex flex-col sm:flex-row gap-3">
                                            <input
                                                type="text"
                                                placeholder="Enter 16+ digit License Key (e.g., A123-B456-C789-D00G)"
                                                value={licenseKeyInput}
                                                onChange={(e) => setLicenseKeyInput(e.target.value)}
                                                onKeyDown={(e) => e.key === 'Enter' && handleActivate()}
                                                disabled={isLoading || statusText === 'ACTIVE'}
                                                className="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 disabled:bg-gray-100 disabled:cursor-not-allowed font-mono text-sm"
                                            />
                                            <button
                                                onClick={handleActivate}
                                                disabled={isLoading || statusText === 'ACTIVE' || licenseKeyInput.trim().length < 16}
                                                className="w-full sm:w-auto px-6 py-3 bg-indigo-600 text-white font-bold rounded-lg shadow-md hover:bg-indigo-700 transition duration-150 disabled:bg-gray-400 disabled:cursor-not-allowed hover:shadow-lg active:scale-[.98]"
                                            >
                                                {isLoading ? (
                                                    <Loader className="h-5 w-5 animate-spin mx-auto" />
                                                ) : 'Activate'}
                                            </button>
                                        </div>
                                        {statusText === 'ACTIVE' && (
                                            <p className="text-sm text-gray-500 mt-2">
                                                A license is already active. Deactivate it below to use a new one.
                                            </p>
                                        )}
                                        {backendSource === 'JavaScript Mock Service' && (
                                            <p className="text-xs text-indigo-500 mt-2">
                                                *Mock Hint: Key must be 16+ characters and include the letter 'G' to succeed.
                                            </p>
                                        )}
                                    </div>

                                    <div className="border p-4 rounded-lg bg-red-50/50">
                                        <h3 className="text-lg font-medium mb-3 text-gray-800 flex items-center">
                                            <Power className="h-4 w-4 mr-2 text-red-600" /> Deactivate License
                                        </h3>
                                        <button
                                            onClick={handleDeactivate}
                                            disabled={isLoading || statusText !== 'ACTIVE'}
                                            className="w-full sm:w-auto px-6 py-3 bg-red-600 text-white font-bold rounded-lg shadow-md hover:bg-red-700 transition duration-150 disabled:bg-gray-400 disabled:cursor-not-allowed hover:shadow-lg active:scale-[.98]"
                                        >
                                            {isLoading ? (
                                                <Loader className="h-5 w-5 animate-spin mx-auto" />
                                            ) : 'Deactivate Current License'}
                                        </button>
                                        <p className="text-sm text-gray-500 mt-2">
                                            Deactivating will free up the license for use on another machine.
                                        </p>
                                    </div>

                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            );
        }

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
